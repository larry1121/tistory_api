<!DOCTYPE html>
<html>

<head>
  <title>API 요청 페이지</title>
  <link rel="stylesheet" href="css/style.css">
 
</head>

<body>
  <h1>API 요청 페이지</h1>
  <form>
    <label for="client_id">client_id:</label>
    <input type="text" id="client_id" name="client_id"><br><br>
    <label for="client_secret">client_secret:</label>
    <input type="text" id="client_secret" name="client_secret"><br><br>
    <label for="redirect_uri">redirect_uri:</label>
    <input type="text" id="redirect_uri" name="redirect_uri"><br><br>
    <input type="button" value="인증 코드 url로 이동" onclick="getAuthenticationCode()"><br><br>
    <label for="code">Authorization Code:</label>
    <input type="text" id="code" name="code"><br><br>
    <input type="button" value="Access Token 요청" onclick="getAccessTokenInCli()"><br><br>
    <label for="access_token">access_token :</label>
    <input type="text" id="access_token" name="access_token"><br><br>
    <label for="blogName">blogName :</label>
    <input type="text" id="blogName" name="blogName"><br><br>
    <input type="button" value="카테고리 ID 들고오기" onclick="getCategoryID()">
  </form>
  <div id="response"></div>
  <div class="instruction">
  <h2>API 요청 페이지 사용법</h2>
  <ol>
    <li>Tistory 개발자센터에 접속하여 애플리케이션 등록을 진행합니다.</li>
    <li>이때 서비스 URL,CallBack은 자신의 티스토리 주소를 활용합니다.</li>
    <li>주소 입력 예시 : https://블로그이름.tistory.com/</li>
    <li>등록한 애플리케이션의 App ID와 Secret Key을 복사하여 API 요청 페이지의 "client_id"와 "client_secret" 입력창에 붙여넣습니다.</li>
    <li>"redirect_uri" 입력창에는 Tistory 개발자센터에서 설정한 CallBack URI를 입력합니다.</li>
    <li>"인증 코드 url로 이동" 버튼을 눌러 Tistory 계정으로 로그인한 후, 인증 코드를 발급받습니다.</li>
    <li>"인증 코드 url로 이동" 버튼을 눌러 Tistory 계정으로 로그인한 후, 인증 코드를 발급받습니다.</li>
    
    <li>발급받은 인증 코드를 API 요청 페이지의 "Authorization Code" 입력창에 입력합니다.</li>
    
    <li>"access_token" 입력창에는 앞서 발급받은 인증 코드로 access_token을 요청받아 복사하여 붙여넣습니다.</li>
    <li>"blogName" 입력창에는 자신의 Tistory 블로그 이름을 입력합니다.</li>
    <li>"카테고리 ID 들고오기" 버튼을 눌러 카테고리 ID를 확인할 수 있습니다.</li>
  </ol>
  <p>※ API 요청 페이지에서 Access Token 요청 기능은 CORS 정책 등의 이유로 작동하지 않을 수 있습니다. 카테고리 ID를 확인하는 기능만을 이용하시길 권장합니다.</p>
</div>
</body>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCKWn_FGZAJMD8YBlDNpJPgWp66g9gVQng",
    authDomain: "officialpractice-bfcfa.firebaseapp.com",
    projectId: "officialpractice-bfcfa",
    storageBucket: "officialpractice-bfcfa.appspot.com",
    messagingSenderId: "865005644925",
    appId: "1:865005644925:web:aa33470500ffe000a51514",
    measurementId: "G-H8GC566RY1"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);

  
function getAccessTokenInCli() {
  
  
  var functions = firebase.functions();
  var getAccessToken = firebase.functions().httpsCallable('getAccessToken');
  
  var client_id = $('#client_id').val().trim();
  var client_secret = $('#client_secret').val().trim();
  var redirect_uri = $('#redirect_uri').val().trim();
  var code = $('#code').val().trim();
  
  getAccessToken({client_id: client_id, client_secret: client_secret, redirect_uri: redirect_uri, code: code})
    .then((result) => {
      $('#response').html(result.data);
    })
    .catch((error) => {
      $('#response').html('Error: ' + error.message);
    });
  }
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Firebase App (이미 로드되어 있다면 생략 가능) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
  <script src=script.js>
    
  </script>
</html>